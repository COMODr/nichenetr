---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# nichenetr

The goal of nichenetr is to explore intercellular communication from a computational perspective. At the basis of this package, is a probabilistic model of ligand-target links that was inferred by data-integration.

## Installation

You can install nichenetr from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("browaeysrobin/nichenetr", build_vignettes = TRUE)
```

## Example

This is a basic example which shows you how to construct the matrix of ligand-target probability scores for ligands of interest, starting from collecting ligand-receptor, signaling and gene regulatory interactions.

To start using nichenetr: 
```{r example}
library(nichenetr)
```

First convert the individual ligand-receptor, signaling and gene regulatory data source networks into weighted integrated networks by weighted aggregation of the individual networks. 

```{r}
weighted_networks = construct_weighted_networks(lr_network, sig_network, gr_network,source_weights_df)
```

In a next step, we will downweigh the importance of hubs in the ligand-signaling and gene regualtory network.

```{r}
weighted_networks = apply_hub_corrections(weighted_networks, lr_sig_hub = 0.5, gr_hub = 0.5)
```
Now we will use these hubiness-corrected weighted networks to calculate probability scores for ligands of interest, here: the ligands of which we will evaluate the target gene prediction later on.
```{r}
ligands = extract_ligands_from_settings(expression_settings_validation)
ligand_target_matrix = construct_ligand_target_matrix(weighted_networks, ligands, algorithm = "PPR", damping_factor = 0.5)
```

Show the names and scores of the top 50 target genes of BMP2
```{r}
extract_top_n_targets("BMP2",50,ligand_target_matrix)
```

Evaluate the target gene prediction performance for 53 ligand-treatment expression datasets
```{r}
settings = lapply(expression_settings_validation, convert_expression_settings_evaluation)
performances = bind_rows(lapply(settings, evaluate_target_prediction, ligand_target_matrix))
performances_discrete = bind_rows(lapply(settings, evaluate_target_prediction, ligand_target_matrix %>% make_discrete_ligand_target_matrix))

```

